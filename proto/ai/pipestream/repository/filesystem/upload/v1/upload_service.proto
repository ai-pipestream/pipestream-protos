syntax = "proto3";

package ai.pipestream.repository.filesystem.upload.v1;

import "ai/pipestream/data/v1/pipeline_core_types.proto";

option java_multiple_files = true;
option java_package = "ai.pipestream.repository.v1.filesystem.upload";
option java_outer_classname = "NodeUploadProto";

enum UploadState {
  UPLOAD_STATE_UNSPECIFIED = 0;
  UPLOAD_STATE_PENDING = 1;
  UPLOAD_STATE_UPLOADING = 2;
  UPLOAD_STATE_COMPLETED = 3;
  UPLOAD_STATE_FAILED = 4;
  UPLOAD_STATE_CANCELLED = 5;
}

// ============================================
// REPOSITORY UPLOAD SERVICE
// Handles efficient storage of documents to S3/MinIO
// ============================================

// S3/MinIO document storage service.
//
// Handles efficient unary uploads of PipeDoc objects to object storage (up to 2GB per document).
// Provides simple upload and retrieval operations without streaming complexity.
service NodeUploadService {
  // Simplified unary upload for full PipeDoc
  // Accepts full payload (up to 2GB) and handles S3 upload internally
  rpc UploadPipeDoc(UploadPipeDocRequest) returns (UploadPipeDocResponse);

  // Retrieve document by ID
  rpc GetDocument(GetDocumentRequest) returns (GetDocumentResponse);
}

message UploadPipeDocRequest {
  ai.pipestream.data.v1.PipeDoc document = 1;
}

message UploadPipeDocResponse {
  bool success = 1;
  string document_id = 2;    // The ID assigned/used
  string s3_key = 3;         // Where it was stored
  string message = 4;
}

message GetDocumentRequest {
  string document_id = 1;
}

message GetDocumentResponse {
  ai.pipestream.data.v1.PipeDoc document = 1;
}
