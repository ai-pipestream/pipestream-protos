syntax = "proto3";

package ai.pipestream.repository.filesystem.upload.v1;

import "ai/pipestream/data/v1/pipeline_core_types.proto";

option java_multiple_files = true;
option java_outer_classname = "NodeUploadProto";
option java_package = "ai.pipestream.repository.v1.filesystem.upload";

enum UploadState {
  UPLOAD_STATE_UNSPECIFIED = 0;
  UPLOAD_STATE_PENDING = 1;
  UPLOAD_STATE_UPLOADING = 2;
  UPLOAD_STATE_COMPLETED = 3;
  UPLOAD_STATE_FAILED = 4;
  UPLOAD_STATE_CANCELLED = 5;
}

// ============================================
// REPOSITORY UPLOAD SERVICE
// Handles efficient storage of documents to S3/MinIO
// ============================================

// S3/MinIO document storage service.
//
// Handles efficient unary uploads of PipeDoc objects to object storage (up to 2GB per document).
// Provides simple upload and retrieval operations without streaming complexity.
service NodeUploadService {
  // Simplified unary upload for full PipeDoc
  // Accepts full payload (up to 2GB) and handles S3 upload internally
  rpc UploadPipeDoc(UploadFilesystemPipeDocRequest) returns (UploadFilesystemPipeDocResponse);

  // Retrieve document by ID
  rpc GetDocument(GetUploadedDocumentRequest) returns (GetUploadedDocumentResponse);
}

// Request to upload a PipeDoc
message UploadFilesystemPipeDocRequest {
  // The document to upload
  ai.pipestream.data.v1.PipeDoc document = 1;
}

// Response from uploading a PipeDoc
message UploadFilesystemPipeDocResponse {
  // Whether the upload succeeded
  bool success = 1;
  // The ID assigned/used for the document
  string document_id = 2;
  // Where it was stored in S3
  string s3_key = 3;
  // Status or error message
  string message = 4;
}

// Request to retrieve a document by ID
message GetUploadedDocumentRequest {
  // The document ID to retrieve
  string document_id = 1;
}

// Response containing the requested document
message GetUploadedDocumentResponse {
  // The retrieved document
  ai.pipestream.data.v1.PipeDoc document = 1;
}
