syntax = "proto3";

package ai.pipestream.repository.account.v1;

import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_outer_classname = "AccountServiceProto";
option java_package = "ai.pipestream.repository.v1.account";

// Account for multi-tenancy
message Account {
  string account_id = 1; // Unique account identifier
  string name = 2; // Account display name
  string description = 3; // Account description
  bool active = 4; // Whether account is active
  google.protobuf.Timestamp created_at = 5; // Creation timestamp
  google.protobuf.Timestamp updated_at = 6; // Last update timestamp
}

// Default drive configuration for account creation.
//
// Used to optionally create a default drive when creating an account.
// Useful for testing and onboarding scenarios.
message DefaultDriveConfig {
  // Drive name (auto-generated if empty, using account_id-based naming).
  string drive_name = 1;
  
  // S3 bucket name (auto-generated if empty, using account_id-based naming).
  string bucket_name = 2;
  
  // Whether to create the S3 bucket in our account.
  bool create_bucket = 3;
  
  // Optional: S3 region (uses default if not specified).
  string region = 4;
  
  // Optional: Bucket configuration (only used if create_bucket=true).
  // Note: BucketConfig is defined in filesystem_service.proto
  // For now, we use a simple approach - bucket config can be set via
  // CreateDriveRequest when the drive is actually created.
}

// Request to create account
message CreateAccountRequest {
  string account_id = 1; // Unique account identifier
  string name = 2; // Account display name
  string description = 3; // Account description
  
  // Optional: Auto-create default drive for testing/onboarding.
  // If true, creates a default drive for the account.
  // The drive will be created via FilesystemService.CreateDrive after account creation.
  bool create_default_drive = 4;
  
  // Optional: Default drive configuration (only used if create_default_drive=true).
  DefaultDriveConfig default_drive_config = 5;
}

// Response from creating account
message CreateAccountResponse {
  // The created or existing account
  Account account = 1;
  // true if created, false if already existed
  bool created = 2;
}

// Request to update account metadata
message UpdateAccountRequest {
  string account_id = 1; // Account identifier (required)
  string name = 2; // Updated display name (required)
  string description = 3; // Updated description (optional)
}

// Response from updating account
message UpdateAccountResponse {
  // The updated account
  Account account = 1;
}

// Request to get account
message GetAccountRequest {
  string account_id = 1; // Account identifier
}

// Response from getting account
message GetAccountResponse {
  // The requested account
  Account account = 1;
}

// Request to inactivate account
message InactivateAccountRequest {
  string account_id = 1; // Account identifier
  string reason = 2; // Reason for inactivation
}

// Response from inactivating account
message InactivateAccountResponse {
  // Whether the operation succeeded
  bool success = 1;
  // Status or error message
  string message = 2;
  // Number of drives that were also inactivated
  int32 drives_affected = 3;
}

// Request to reactivate account
message ReactivateAccountRequest {
  string account_id = 1; // Account identifier
  string reason = 2; // Reason for reactivation
}

// Response from reactivating account
message ReactivateAccountResponse {
  // Whether the operation succeeded
  bool success = 1;
  // Status or error message
  string message = 2;
}

// Request to list accounts with optional filters
message ListAccountsRequest {
  // Optional partial search on account_id or name
  string query = 1;
  // Whether to include inactive accounts (defaults to false)
  bool include_inactive = 2;
  // Pagination - page size (defaults to 50, max 200)
  int32 page_size = 3;
  // Pagination - page token (offset cursor)
  string page_token = 4;
}

// Response for account listing
message ListAccountsResponse {
  // List of accounts matching the query
  repeated Account accounts = 1;
  // Token for retrieving the next page (empty if last page)
  string next_page_token = 2;
  // Total count of matching accounts
  int32 total_count = 3;
}

// Account service
service AccountService {
  // Register a new account
  rpc CreateAccount(CreateAccountRequest) returns (CreateAccountResponse);

  // Update account metadata
  rpc UpdateAccount(UpdateAccountRequest) returns (UpdateAccountResponse);

  // Get account details
  rpc GetAccount(GetAccountRequest) returns (GetAccountResponse);

  // Inactivate account (soft delete)
  rpc InactivateAccount(InactivateAccountRequest) returns (InactivateAccountResponse);

  // Reactivate account
  rpc ReactivateAccount(ReactivateAccountRequest) returns (ReactivateAccountResponse);

  // List accounts with optional filtering
  rpc ListAccounts(ListAccountsRequest) returns (ListAccountsResponse);
}
